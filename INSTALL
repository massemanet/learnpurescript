# -*- mode: shell-script -*-
#!/bin/bash

function usage () {
    echo "$1"
    exit
}

# find our platform
case "$(uname -s)" in
    ("Linux")  SYS=linux64;;
    ("Darwin") SYS=macos;;
    (*) usage "I only work on Linux and Darwin"
esac
# find the current purescript tarball and download it
PSC=https://github.com/purescript/purescript/releases
TRG=$(wget -qO - $PSC | grep -Eo "/download/.*/$SYS.tar.gz"| head -1)
echo "your system is $SYS. getting purecript vsn $(echo $TRG | cut -f3 -d"/")."
wget $PSC/$TRG
# get tarball from https://github.com/purescript/purescript/releases
# and unpack
tar -xzf $SYS.tar.gz
rm $SYS.tar.gz
# move the psc* binaries to somewhere in the path
sudo mv purescript/psc* /usr/local/bin
rm -rf ./purescript
# install some dependencies globally
sudo npm install -g grunt-cli bower jshint
# install the project local stuff from package.json and bower.json
npm install && bower update
# build and run Hello World
grunt && node dist/Main.js
